<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>joe di castro - HTML</title>
  <meta name="author" content="joe di castro" />
  <meta name="keywords" content="joe di castro, blog">
  <link rel="author" href="humans.txt" />
  <link rel="stylesheet" href=".././theme/css/main.css" type="text/css" />
  <link href=".././atom.xml" type="application/atom+xml" rel="alternate" title="joe di castro ATOM Feed" />
  <link href=".././rss.xml" type="application/atom+xml" rel="alternate" title="joe di castro RSS Feed" />
  
  <link href=".././feeds/tags/HTML.atom.xml" type="application/atom+xml" rel="alternate" title="joe di castro - HTML ATOM Feed" />
  <link href=".././feeds/tags/HTML.rss.xml" type="application/atom+xml" rel="alternate" title="joe di castro - HTML RSS Feed" />

  <!--[if IE]><script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
</head>
<body id="index" class="home">

  <header id="banner" class="body">
    <h1><a href="../."><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJYAAAAxBAMAAADKNk2HAAAAElBMVEW/kiXQsGLey5vn3b/s5dH3+fXlDfF2AAADFElEQVRIDa3Bu3LbOABA0QtQ7KFo0TPOqmfiZU/PmD1A8v7/r6yejpPIkxlL5+BP85aQ/Ty8WhJH2U/Dixl2ky80fhqeVaJHI34answ0nlS8bR38GzwhejYzeFPK/g0ejUyezUzesuBHusEzPFjIXlS8qTR+YMYLPOiDVwVvStkPjBsvUFdar0rwlgU/wt4L1IJvusZbSuMHanh9nTxB7aNvaL0lZX8z86tJUVPj1cLeG2b8Xd1ut09P337w3+vr8/PzNxU1Ra8K3jJu/ECJvkHt2T151kdvYe8HUvYNaoXgGa03VJy84dkZf8KDeTd5MrP3hr6t0T+Nwb519QrfK3jDyj5l/8RGhgWv8L2u8c3kVQkuvrc8eVAZSrALXuF7ZJ3j10m/gyfLtk2tF2tirz1kNW1M7Urrwcvui+I7FV2A1gTBowpbhpfBkxRS60hkryPDgoWp0woM4jt9XDsIqe3Zd3snXYh2YWXwqA8L+4V/1qALWKJ96IJCZFrwHQIHmSeyOm40RWfaEj2qDH00RUujXcSUTdA6wgtzwJ9mCClQSXEdXBmsaGIi22dN2TR0TJKtoYQFa9gyrdD0kYxv1sRupoSOg439RlNrJc44ozWoldYRV3LZlGjKJTqG1EAjXi3QOm4K8IMwVXRlWKEdW1OrXdYVpoXWFE1tynMw5ZWcICheLMBkGhbiVBkkaw12MDHUoCtqR2NiGPke2TF0ecEeCzsVz1ZCH1xxZDC1do1a4gt9nMPMoLXRnpR7qLQpMfIlWDaVxhQ8wLMUJloXOrIVx+BBgZzaGslqaX1hk7Z0sFkhdiFl+0CKicEDPOkZKpNC1NK8sPeg0qwMM40HJXZEO3IhusDA16A9TYXsER5Vsn1U571aYOPJq3PUV49miLoMzkFddEpZHfTH5Ake0SjZi4WdN3z/11998Vd4MDJZ8F6oC1nTxnuh9kFn9t4LXcg6Bu+GjkGl9W4orVYm74aVSVPj/bCLOrP3fkjWPvgAVHQl+wCUqAUfga5VWh8BsgUfAvJK60NAk/AxSJB9DEY2Psj/Dz0Ida72jQIAAAAASUVORK5CYII=" alt="joe di castro" title="joe di castro" width="150" height="49" /> </a></h1>
      <nav>
      	<ul>
         
         <li ><a href=".././category/blog.html">blog</a></li>
         <li><a href=".././archives.html">archivos</a></li>
         <li><a href=".././tags.html">etiquetas</a></li>
         
         <li><a href=".././pages/markdown.html">markdown</a></li><li><a href=".././pages/sobre-mi.html">sobre mi</a></li>
         
       </ul>
     </nav>
  </header><!-- /#banner -->        

          
    
    
    <aside id="featured" class="body">
      <article>
        <h1 class="entry-title"><a href=".././pelican-publicacion-y-automatizacion.html">Pelican - Publicación y automatización</a></h1> 
        <p>Una vez que sabemos como <a href="../static/pelican-introduccion-e-instalacion.html">instalar Pelican</a> y <a href="../static/pelican-creacion-de-contenido.html">crear contenido</a> con él, es 
hora de saber como convertir ese contenido en un blog real disponible en 
internet. Es decir, saber como publicar ese contenido. Como hemos visto hasta 
ahora, al constar básicamente de simples ficheros HTML, un servidor de 
archivos es más que suficiente para servir el blog. Esto nos abre un gran 
abanico de posibilidades, desde emplear un potente (y barato) servidor de 
ficheros en la <em>nube</em> como <strong>Amazon S3</strong> (<a href="http://jdacpelican.s3-website-us-east-1.amazonaws.com/">un ejemplo</a>), pasando por las 
páginas web estáticas que nos permiten repositorios como <strong>Bitbucket</strong> o 
<strong>GitHub</strong> (<a href="http://marsam.github.com/blog/">un ejemplo</a>), por los tradiciones hostings compartidos (e.g. 
este blog), hasta un servidor casero sencillo montado sobre un <a href="http://es.wikipedia.org/wiki/Network-attached_storage">NAS</a>. </p>
<p>Aún cuando es posible emplear un simple servidor de archivos para alojar el blog, 
siempre es mejor contar con un servidor web detrás (Apache, nginx, lighttpd, 
...) que nos permita hacer redirecciones para nuestras antiguas páginas si ya 
disponíamos de un blog anterior o manejar los errores HTTP <a href="http://es.wikipedia.org/wiki/Error_404">404</a> o <a href="http://es.wikipedia.org/wiki/Anexo:C%C3%B3digos_de_estado_HTTP">403</a> 
de forma personalizada. </p>
<h3 id="publicar_el_contenido">Publicar el contenido</h3>
<p>Publicar el contenido de una web es tan sencillo como volcar el contenido del 
directorio que nos genera Pelican (en nuestro ejemplo sería 
<em>myblog.com/site/output/*</em>) en el directorio destino de nuestro servidor web. 
Dependiendo del método que hayamos elegido para alojar nuestro blog, puede ser 
tan sencillo como una copia de archivos o emplear FTP (SFTP) ó <a href="http://es.wikipedia.org/wiki/SSH">SSH</a> (<a href="http://es.wikipedia.org/wiki/SCP">SCP</a>, 
<a href="http://en.wikipedia.org/wiki/Unison_%28file_synchronizer%29">Unison</a> ó <a href="http://es.wikipedia.org/wiki/Rsync">rsync</a>). Aquí el tema radica no en la primera vez que 
vayamos a subir el contenido al servidor, si no en las sucesivas, a medida que 
vayamos creando contenido nuevo. No tendría ningún sentido volver a subir todo 
el contenido cada vez, si no solamente el nuevo o el que haya cambiado. Para eso 
necesitamos sincronizar los dos directorios. </p>
<p>Si solamente disponemos de acceso FTP (o SFTP) a nuestro servidor, entonces 
tendremos que emplear una herramienta que nos permita la sincronización sobre 
FTP, como puede ser <strong>lftp</strong>. Y el proceso se puede automatizar con un script 
como el que describo en <a href="../static/sincronizar-una-carpeta-local-y-una-remota-a-traves-de-ftp-lftp-mirror.html">Sincronizar una carpeta local y una remota a través de 
FTP: lftp-mirror</a>. Si disponemos de acceso a través de SSH, entonces la 
elección es clarisima, <strong>rsync</strong>. Más adelante explico una manera de emplearlo 
de forma automática.</p>
<p>Cualquiera de ambas soluciones nos permite subir el contenido en apenas segundos, 
(sobre todo en el caso de rsync) cuando se trata de añadir un articulo nuevo, 
por ejemplo. Y lo mismo a la hora de hacer una rectificación, es tan inmediato 
como lo pueden ser plataformas como Wordpress, Drupal y similares. Además, con 
las potentes herramientas que existen para hacer cambios múltiples en varios 
ficheros de texto a la vez, se pueden realizar tareas casi imposibles con una 
plataforma de blogs tradicional sin recurrir a consultas SQL en la BDD o a 
plugins externos. Una de estas herramientas, sin recurrir a <code>find</code>, <code>grep</code>, 
<code>awk</code> y <code>sed</code>, puede ser <a href="http://regexxer.sourceforge.net/">regexxer</a>.</p>
<h3 id="generar_el_contenido_en_el_propio_servidor">Generar el contenido en el propio servidor</h3>
<p>Si el alojamiento que hemos escogido nos permite instalar programas python, 
entonces tenemos la posibilidad de instalar Pelican en el servidor remoto. De 
esta formar podríamos subir únicamente los archivos markdown o reStructuredText 
al servidor y generar allí mismo el contenido web. De este modo la cantidad de 
datos a subir sería ridícula y un simple comando FTP nos serviría. Luego bien 
podríamos lanzar Pelican a través de una consola SSH o bien dependiendo del 
servidor, tener un <a href="http://es.wikipedia.org/wiki/Demonio_%28inform%C3%A1tica%29">demonio</a> corriendo que cuando detectara un cambio en el 
sistema de ficheros lanzará un script que generara el contenido con Pelican. </p>
<p>Otra posibilidad que me convence más, es de la poder instalar un repositorio en 
el servidor con un software de control de versiones, como Git o Mercurial. La 
idea sería tener un repositorio local, y al hacer un push hacia el repositorio 
remoto, a través de un <em>hook</em> activar la generación de la página con Pelican. 
Esto nos permitiría además poder tener varias copias del repositorio (por 
ejemplo en GitHub o Bitbucket) y por lo tanto de la web, haciendo "innecesarias" 
las copias de seguridad. </p>
<h3 id="automatizar_todos_los_procesos">Automatizar todos los procesos</h3>
<p>Pero lo ideal es poder automatizar todas las tareas que hemos visto hasta ahora, 
empleando unos pocos comandos para realizarlas sin esfuerzo alguno (bueno, 
a menos que tengas tú <a href="http://es.wikipedia.org/wiki/Negro_%28escritor%29">ghostwriter</a> particular, me temo que los artículos los 
seguirás teniendo que escribir tú). Para poder realizar esto disponemos de la 
fantástica y potente herramienta <a href="http://fabfile.org">Fabric</a> (el <a href="http://en.wikipedia.org/wiki/Capistrano">Capistrano</a> para Python) 
que nos permite ejecutar comandos locales o remotos en múltiples servidores. Esto 
nos permite hacer despliegues de software sin apenas esfuerzo en distintas 
máquinas, copiar ficheros o ejecutar tareas repetitivas empleado una corta 
serie de comandos. Una grandísima herramienta para administradores de sistema y 
desarrolladores.</p>
<p>Lo único que necesitamos es instalar <strong>fabric</strong> y crear un fichero llamado 
<code>fabfile.py</code> donde especificaremos las tareas que queremos programar. Para 
instalar la última versión estable de fabric, lo mejor es emplear <code>easy_install</code> 
o <code>pip</code></p>
<div class="codehilite"><pre><span class="gp">$</span> pip install fabric
</pre></div>


<p>Una vez creado el fichero <code>fabfile.py</code>, lo único que tendremos que hacer para 
ejecutar una tarea del mismo, sería escribir el comando <code>fab</code> seguido del nombre 
que le hayamos dado a la tarea (este sería el funcionamiento básico). Y la tarea 
se ejecutaría inmediatamente. </p>
<p>Para comprender mejor como funciona Fabric, muestro aquí el contenido actual de 
mi fichero <code>fabfile.py</code><br />
</p>
<div class="codehilite"><pre><span class="c">#!/usr/bin/env python</span>
<span class="c"># -*- coding: utf8 -*-</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    fabfile.py: A fabric script for generate my personal blog</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s">&quot;joe di castro &lt;joe@joedicastro.com&gt;&quot;</span>
<span class="n">__license__</span> <span class="o">=</span> <span class="s">&quot;GNU General Public License version 3&quot;</span>
<span class="n">__date__</span> <span class="o">=</span> <span class="s">&quot;28/06/2011&quot;</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s">&quot;0.2&quot;</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">fabric.api</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">fabric.contrib.project</span> <span class="kn">import</span> <span class="n">rsync_project</span>
<span class="kn">from</span> <span class="nn">fabric.contrib.console</span> <span class="kn">import</span> <span class="n">confirm</span>

<span class="n">PELICAN_REPOSITORY</span> <span class="o">=</span> <span class="s">&quot;git://github.com/ametaireau/pelican.git&quot;</span>
<span class="n">PROD</span> <span class="o">=</span> <span class="s">&quot;joedicastro.com&quot;</span>
<span class="n">PROD_PATH</span> <span class="o">=</span> <span class="s">&quot;/home/joedicastro/webapps/joedicastro&quot;</span>
<span class="n">LOCAL_WEB</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&quot;~/www&quot;</span><span class="p">,</span> <span class="n">PROD</span><span class="p">)</span>
<span class="n">ROOT_PATH</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">))</span>
<span class="n">ENV_PATH</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ROOT_PATH</span><span class="p">,</span> <span class="s">&quot;env&quot;</span><span class="p">)</span>
<span class="n">PELICAN</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ROOT_PATH</span><span class="p">,</span> <span class="s">&quot;pelican&quot;</span><span class="p">)</span>
<span class="n">CONFIG_FILE</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ROOT_PATH</span><span class="p">,</span> <span class="s">&quot;site/pelican.conf.py&quot;</span><span class="p">)</span>
<span class="n">OUTPUT</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ROOT_PATH</span><span class="p">,</span> <span class="s">&quot;site/output&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_valid_HTML</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Remove the obsolete rel=&quot;&quot; and rev=&quot;&quot; links in footnotes.&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">path</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">OUTPUT</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">fil</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">fil</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:]</span> <span class="o">==</span> <span class="s">&quot;.html&quot;</span><span class="p">:</span>
                <span class="n">local</span><span class="p">(</span><span class="s">&quot;sed -i {0} -r -e &#39;s/re[l|v]=</span><span class="se">\&quot;</span><span class="s">footnote</span><span class="se">\&quot;</span><span class="s">//g&#39; {0}&quot;</span><span class="o">.</span>
                      <span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">fil</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">,</span> <span class="s">r&quot;\ &quot;</span><span class="p">))))</span>

<span class="k">def</span> <span class="nf">_make_env</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Make a virtual enviroment&quot;&quot;&quot;</span>
    <span class="n">local</span><span class="p">(</span><span class="s">&quot;virtualenv {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ENV_PATH</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">_del_env</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Delete a virtual enviroment.&quot;&quot;&quot;</span>
    <span class="n">local</span><span class="p">(</span><span class="s">&quot;rm -rf {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ENV_PATH</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">_clone_pelican</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Clone Pelican from repository.&quot;&quot;&quot;</span>
    <span class="n">local</span><span class="p">(</span><span class="s">&quot;git clone {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">PELICAN_REPOSITORY</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">_install</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Install Pelican in the virtual enviroment.&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">lcd</span><span class="p">(</span><span class="n">PELICAN</span><span class="p">):</span>
        <span class="n">local</span><span class="p">(</span><span class="s">&quot;{0}/bin/python setup.py install&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ENV_PATH</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">_browse</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Browse the local Apache site.&quot;&quot;&quot;</span>
    <span class="n">local</span><span class="p">(</span><span class="s">&quot;firefox -new-window http://localhost/joedicastro.com 2&gt;/dev/null &amp;&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_gen</span><span class="p">(</span><span class="n">autoreload</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Generate the site from source.&quot;&quot;&quot;</span>
    <span class="n">local</span><span class="p">(</span><span class="s">&quot;{0}/bin/pelican {2} -s {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ENV_PATH</span><span class="p">,</span> <span class="n">CONFIG_FILE</span><span class="p">,</span>
                                              <span class="s">&quot;-r&quot;</span> <span class="k">if</span> <span class="n">autoreload</span> <span class="k">else</span> <span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">_clean</span><span class="p">():</span>
    <span class="s">&quot;Remove the output folder.&quot;</span>
    <span class="n">local</span><span class="p">(</span><span class="s">&quot;rm -rf {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">OUTPUT</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">_local_deploy</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Deploy to the local apache web server.&quot;&quot;&quot;</span>
    <span class="n">local</span><span class="p">(</span><span class="s">&quot;rm  -rf {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">LOCAL_WEB</span><span class="p">))</span>
    <span class="n">local</span><span class="p">(</span><span class="s">&quot;cp -r {0} {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">OUTPUT</span><span class="p">,</span> <span class="n">LOCAL_WEB</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">pull_pelican</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Update Pelican to last revision from repository.&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">lcd</span><span class="p">(</span><span class="n">PELICAN</span><span class="p">):</span>
        <span class="n">local</span><span class="p">(</span><span class="s">&quot;git pull&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">bootstrap</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Get Pelican and install it in a virtual enviroment.&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">settings</span><span class="p">(</span><span class="n">warn_only</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="n">_del_env</span><span class="p">()</span>
    <span class="n">_make_env</span><span class="p">()</span>
    <span class="k">with</span> <span class="n">settings</span><span class="p">(</span><span class="n">warn_only</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="n">_clone_pelican</span><span class="p">()</span>
    <span class="n">_install</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">regen</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Regenerate the site from source.&quot;&quot;&quot;</span>
    <span class="n">_clean</span><span class="p">()</span>
    <span class="n">_gen</span><span class="p">()</span>
    <span class="n">_valid_HTML</span><span class="p">()</span>
    <span class="n">_local_deploy</span><span class="p">()</span>

<span class="nd">@hosts</span><span class="p">(</span><span class="s">&quot;my_user@&quot;</span> <span class="o">+</span> <span class="n">PROD</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">publish</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Publish into remote web server with rsync.&quot;&quot;&quot;</span>
    <span class="n">regen</span><span class="p">()</span>
    <span class="n">_browse</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">confirm</span><span class="p">(</span><span class="s">&quot;¿Estas seguro de querer publicarlo?&quot;</span><span class="p">):</span>
        <span class="n">rsync_project</span><span class="p">(</span><span class="n">PROD_PATH</span><span class="p">,</span> <span class="n">OUTPUT</span> <span class="o">+</span> <span class="s">&quot;/&quot;</span><span class="p">,</span> <span class="n">delete</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">new</span><span class="p">(</span><span class="n">title</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create a new blog article.&quot;&quot;&quot;</span>
    <span class="n">local</span><span class="p">(</span><span class="s">&quot;gedit --new-window {0}/site/source/blog/{1}.md 2&gt;/dev/null &amp;&quot;</span><span class="o">.</span>
          <span class="n">format</span><span class="p">(</span><span class="n">ROOT_PATH</span><span class="p">,</span> <span class="n">title</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">,</span> <span class="s">&quot;\ &quot;</span><span class="p">)))</span>
    <span class="n">local</span><span class="p">(</span><span class="s">&quot;firefox --new-window {0}/index.html &amp;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">OUTPUT</span><span class="p">))</span>
    <span class="n">_gen</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">img4web</span><span class="p">(</span><span class="n">delete</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Optimize .jpg &amp; .png images and copy them into source pictures dir.&quot;&quot;&quot;</span>
    <span class="n">local</span><span class="p">(</span><span class="s">&quot;./img4web.py -d {0} {1} {2}&quot;</span><span class="o">.</span>
          <span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ROOT_PATH</span><span class="p">,</span> <span class="s">&quot;site/source/pictures&quot;</span><span class="p">),</span>
                 <span class="s">&quot;--delete&quot;</span> <span class="k">if</span> <span class="n">delete</span> <span class="k">else</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
                 <span class="s">&quot;-s {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">source</span><span class="p">)</span> <span class="k">if</span> <span class="n">source</span> <span class="k">else</span> <span class="s">&quot;&quot;</span><span class="p">))</span>
</pre></div>


<p>Ahora, veremos el funcionamiento básico que nos permite este script. Primero 
vemos las tareas que tenemos disponibles:</p>
<div class="codehilite"><pre><span class="gp">$</span> fab -l
<span class="go">    fabfile.py: A fabric script for generate my personal blog</span>

<span class="go">Available commands:</span>

<span class="go">    bootstrap     Get Pelican and install it in a virtual enviroment.</span>
<span class="go">    img4web       Optimize .jpg &amp; .png images and copy them into source pict...</span>
<span class="go">    new           Create a new blog article.</span>
<span class="go">    publish       Publish into remote server with rsync.</span>
<span class="go">    pull_pelican  Update Pelican to last revision from repository.</span>
<span class="go">    regen         Regenerate the site from source.</span>
</pre></div>


<p>Veamos que hacen cada una de ellas:</p>
<ul>
<li>
<p><strong><em>bootstrap</em></strong> Si observamos el código, veremos que lo hace es, en este orden: 
eliminar cualquier entorno virtual previo, crear un entorno virtual nuevo, 
descargar Pelican desde el repositorio (si no lo hemos hecho anteriormente) e 
instalar Pelican dentro de este entorno virtual. Y todo esto en un solo paso, casi 
todos los comandos que explicaba en <a href="../static/pelican-introduccion-e-instalacion.html">Pelican - Introducción e Instalación</a> con 
solo  teclear <code>fab bootstrap</code>. Así de fácil. Con este comando podemos tanto crear 
una instalación de Pelican desde cero, como actualizar la instalación de Pelican 
después de actualizar este a la última versión con <strong><em>pull-pelican</em></strong>. Siguiendo 
con nuestro ejemplo, lo que haría este comando es crear los directorios <em>env</em> y 
<em>pelican</em> dentro de <em>myblog.com</em> con el entorno virtual creado y pelican 
instalado.</p>
<div class="codehilite"><pre><span class="gp">$</span> fab bootstrap
</pre></div>


</li>
<li>
<p><strong><em>img4web</em></strong> Este comando hace uso del script que describía en <a href="../static/optimizar-imagenes-para-la-web.html">Optimizar 
imágenes para la web</a> para hacer precisamente eso, reducir el peso de las 
imágenes que empleo en los artículos. Lo que hago es a medida que voy escribiendo 
el articulo es ir guardando las imágenes en el directorio raíz (en nuestro 
ejemplo, <em>myblog.com/</em>) y cuando lo termino, simplemente ejecuto el comando 
<code>fab img4web</code> y este me optimiza las imágenes, me guarda las optimizadas en el 
directorio de imágenes del contenido (<em>myblog.com/site/source/pictures/</em>) y me 
elimina las imágenes originales del directorio raíz. Cuando termina me muestra un 
resumen con la cantidad de imágenes procesadas y el ahorro en espacio conseguido. 
Espacio en disco ahorrado que se resume en menos ancho de banda consumido y en 
páginas web que se cargan más rápido.</p>
<div class="codehilite"><pre><span class="gp">$</span> fab img4web
</pre></div>


</li>
<li>
<p><strong><em>new</em></strong> Con este creo o edito los artículos del blog. Realiza 
tres funciones: me abre una venta de Gedit con el articulo que le indico con la 
extensión <code>.md</code>, me abre una ventana de Firefox que me muestra el fichero 
<em>index.html</em> del directorio del sitio generado por Pelican 
(<em>myblog.com/site/output/index.html</em>) y finalmente me activa Pelican con la 
opción <code>autoreload</code>. Luego empleando el plugin <strong>Grid</strong> de Compiz, divido la 
pantalla en dos mitades y coloco a la izquierda Gedit y a la derecha Firefox. 
Esto me permite, como explicaba en <a href="../static/de-drupal-a-pelican.html">De Drupal a Pelican</a> editar el contenido 
y previsualizar el resultado casi en tiempo real, disponiendo al mismo tiempo de 
un buen corrector ortográfico. </p>
<div class="codehilite"><pre><span class="gp">$</span> fab new:<span class="s2">&quot;Articulo de prueba&quot;</span>
</pre></div>


</li>
<li>
<p><strong><em>publish</em></strong> El más importante, el que sube los artículos al servidor web. 
Publicar el contenido de la web es tan sencillo como ejecutar este comando. Lo 
que hace es regenerar el contenido (por si hubiera algún cambio sin guardar) y 
luego mostrarme el resultado en firefox. Pero el resultado que me muestra no es 
el del directorio de salida de Pelican, si no de una copia que tengo en un 
servidor Apache local. Esto me permite ver los cambios de manera más fiel a la 
versión web, puesto que hace uso del fichero .htaccess y de las reglas que tengo 
establecidas en él. Finalmente me pregunta si realmente deseo publicar el 
contenido, por si se me hubiera escapado algo. Si le digo que no, aborta la 
publicación, pero si le digo que si, me sincroniza el contenido de la carpeta 
local con la remota empleando <strong>rsync</strong>. De esta manera solo se transmiten los 
ficheros nuevos, se borran los que se hayan eliminado en local y <strong>solo transmite 
la parte que haya cambiado de los archivos modificados</strong>. Gracias a esto, 
modificar o añadir contenido es cuestión de segundos. Y sencillisimo.</p>
<div class="codehilite"><pre><span class="gp">$</span> fab publish
</pre></div>


</li>
<li>
<p><strong><em>pull_pelican</em></strong> Nos sirve para actualizar Pelican a la última revisión 
disponible en el repositorio oficial. Si después de ejecutarlo, queremos instalar 
la nueva versión en nuestro entorno virtual para poder emplearla, simplemente 
tenemos que volver a ejecutar <code>fab bootstrap</code> y todo se realizará de forma 
automática.</p>
<div class="codehilite"><pre><span class="gp">$</span> fab pull_pelican
</pre></div>


</li>
<li>
<p><strong><em>regen</em></strong> El proceso principal, es el que le pide a Pelican que genere el 
sitio web a partir de nuestro directorio de origen. También realiza varios 
procesos: primero eliminar el directorio de salida actual (para tener una copia 
fresca), genera el nuevo contenido, luego procesa los archivos para que 
validen en HTML5 y finalmente hace una copia del directorio de salida a mi 
servidor local Apache. El procesar los archivos para validar en HTML5 se debe a 
que markdown crea unos enlaces <code></code> y <code></code> en las notas 
al pie que se han quedado obsoletos y no son necesarios. De momento es un 
post-procesado, pero puede que finalmente modifique Pelican para que se haga en 
tiempo de generación del sitio. Aunque creo que  el rendimiento de esta manera 
sería menor que emplear el comando <code>sed</code> que ejecuta este proceso, será cuestión 
de probarlo. También se podría modificar markdown.</p>
</li>
</ul>
<p>Con solo <strong>6</strong> comandos tengo automatizadas todas las tareas básicas para 
administrar y crear contenido en mi blog. Ni siquiera el potente y buenísimo 
<a href="http://drupal.org/project/drush">drush</a> de Drupal me permitía este nivel de automatización (aunque se 
acercaba bastante). De esta manera solo me tengo que preocupar de crear 
artículos y de las posibles personalizaciones que le quiera realizar al tema del 
sitio. Me olvido de todo lo demás, de todo lo que conlleva un CMS. Solo hay una 
manera de bloguear más cómoda para los que a estos les parezca algo complejo, 
servicios como Tumblr. Aunque si quieres tener el control sobre tu sitio, no 
conozco manera más cómoda y con más ventajas que esta. </p>
        <p>Hay <a href=".././pelican-publicacion-y-automatizacion.html#disqus_thread">comentarios</a>.</p>
      </article>
      
    </aside><!-- /#featured -->
      
      <section id="content" class="body">
        <h1>Otros articulos</h1>
        <hr />
        <ol id="posts-list" class="hfeed">
      
    
    
    
        
    
     
      
            <li>
              <article class="hentry">    
                <header>
                  <h1><a href=".././pelican-introduccion-e-instalacion.html" rel="bookmark" title="Permalink a Pelican - Introducción e Instalación">Pelican - Introducción e Instalación</a></h1>
                </header> 
                <div class="entry-content">
                  <p><a href="http://docs.notmyidea.org/alexis/pelican/">Pelican</a> es un generador de sitios web con contenido estático. Está orientado 
originalmente a la creación de blogs. <strong>Pelican</strong> (Pelicano) es una anagrama de 
la palabra francesa <em>Calepin</em> que significa en español "cuaderno de notas" 
(blog). Su creador y desarrollador principal es el programador francés 
<a href="http://blog.notmyidea.org/">Alexis Métaireau</a>. Y es la ...</p>
                  <a class="readmore" href=".././pelican-introduccion-e-instalacion.html">leer más</a>
                  <p>Hay <a href=".././pelican-introduccion-e-instalacion.html#disqus_thread">comentarios</a>.</p>
                </div><!-- /.entry-content -->
              </article></li>
    
    
        
    
     
      
            <li>
              <article class="hentry">    
                <header>
                  <h1><a href=".././de-drupal-a-pelican.html" rel="bookmark" title="Permalink a De Drupal a Pelican">De Drupal a Pelican</a></h1>
                </header> 
                <div class="entry-content">
                  <p>Este blog no está realizado con ningún <abbr title="Content Management System (en español, &quot;Sistema de gestión de contenidos&quot;)">CMS</abbr>, ni siquiera utiliza <abbr title="Base de datos">BDD</abbr> alguna, es 
simplemente HTML + CSS y nada más. Es decir, es contenido estático, no dinámico.
Hasta hace 3 días estaba funcionando con el mejor <abbr title="Content Management System (en español, &quot;Sistema de gestión de contenidos&quot;)">CMS</abbr> <a href="http://es.wikipedia.org/wiki/PHP">PHP</a> que conozco, 
<a href="http://drupal.org">Drupal</a>. Pero persiguiendo el camino hacia el minimalismo y la ...</p>
                  <a class="readmore" href=".././de-drupal-a-pelican.html">leer más</a>
                  <p>Hay <a href=".././de-drupal-a-pelican.html#disqus_thread">comentarios</a>.</p>
                </div><!-- /.entry-content -->
              </article></li>
    
    
      <li id="paginator">
  
  Pagina 1 de 2
  
    <a href=".././tag/HTML2.html"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAMAAAC6V+0/AAABYlBMVEUAAAABAQECAgIDAwMFBQUGBgYHBwcICAgJCQkKCgoLCwsMDAwNDQ0QEBARERESEhIXFxcYGBgaGhodHR0oKCgpKSksLCwtLS0uLi4yMjIzMzM0NDQ3Nzc8PDxDQ0NFRUVGRkZYWFhcXFxdXV1jY2NlZWV9fX2BgYGCgoKDg4OFhYWHh4eKioqLi4uMjIyOjo6SkpKVlZWWlpacnJydnZ2fn5+kpKSmpqapqamsrKytra2urq6vr6+zs7O1tbW2tra3t7e9vb3Dw8PExMTFxcXGxsbHx8fJycnKysrMzMzOzs7Pz8/Q0NDR0dHS0tLT09PU1NTV1dXX19fY2NjZ2dna2trb29vc3Nzd3d3e3t7f39/i4uLj4+Pl5eXm5ubo6Ojp6enq6urr6+vs7Ozu7u7v7+/w8PDx8fHy8vLz8/P09PT19fX29vb39/f4+Pj5+fn6+vr7+/v8/Pz9/f3+/v7///+41hGNAAABZElEQVQYVyWR51vCQAzG48DKnbj33ntvpSqKA3ADKihaQbTWlqu9Xv5/U8yTD/e8SZ68+R0golLyVzg/juP+SqVIAFQoxXfpS3ie+Ho3hSQBED37493/yRzH7r/91w/bo04lbeMNY72RUKip5wwNw5YKlCjmcQMYZ5SwgPmi8EGaOTsb4bxjlwo8nKjkTA88I40TGuf9eNYW5uFBvDVcELkk1lIPG8VCS5iBlXq2oZI+LwOn0PqsQjuH5O29Bc71sV8VG0ZkopXD08WVCc7VEXb8j58CY/V4eE3i3YHYbggWnTYzHppROo2L/P55ZVDj7cs1jDd2ft7s5WyydLL6YA3XMI3xum6jvBInS9LMROcfcHOoq2tgBQtzeobM05mpnbl5A12B5cXZnVRwZgDkMro8NTY9PT65pF9WgQToitm4vrW+tqXHs8UqOmLqu1bp5TGdfnwpWa7/D5m+QylfUvjBi4Q/dvFzY07mp8kAAAAASUVORK5CYII=" alt="&laquo;" title="siguiente" width="20" height="20" /></a>
  
</li>
    

    
     </ol><!-- /#posts-list -->
    </section><!-- /#content -->


<section id="extras" class="body">
    
    <div class="blogroll">
      <h2>enlaces</h2>
        <ul>
          <li><a href="http://photo.joedicastro.com/">Fotografías</a></li>
          <li><a href="http://code.joedicastro.com/">Código</a></li>
          <li><a href="http://python.majibu.org/">python majibu</a></li>
          <li><a href="http://python-hispano.org/">python hispano</a></li>
          <li><a href="http://planet.python-hispano.org/">planeta python hispano</a></li>
        </ul>
    </div><!-- /.blogroll -->
    
    
    <div class="social">
      <h2>social</h2>
        <ul>
          <li><a href=".././atom.xml" rel="alternate">atom</a></li>
          <li><a href=".././rss.xml" rel="alternate">rss</a></li>
          
          <li><a href="http://twitter.com/joe_di_castro">twitter</a></li>
          <li><a href="http://identi.ca/joedicastro">identi.ca</a></li>
          <li><a href="http://www.facebook.com/joedicastr0">facebook</a></li>
          <li><a href="https://bitbucket.org/joedicastro">bitbucket</a></li>
        </ul>
    </div><!-- /.social -->
    
  </section><!-- /#extras -->
  <footer id="contentinfo" class="body">
    <address id="about" class="vcard body">
      © 2010-2011 joe di castro. Powered by <a href="http://alexis.notmyidea.org/pelican/">pelican</a><span id="license">Los contenidos están bajo una <a href="http://creativecommons.org/licenses/by-sa/3.0/es">licencia Creative Commons</a></span>
    </address><!-- /#about -->
  </footer><!-- /#contentinfo -->

  <script type="text/javascript">
    
        var pkBaseURL = (("https:" == document.location.protocol) ? "https://joedicastro.com/piwik/" : "http://joedicastro.com/piwik/");
    
    document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
    </script><script type="text/javascript">
    try {
    var piwikTracker = Piwik.getTracker(pkBaseURL + "piwik.php", 1);
    piwikTracker.trackPageView();
    piwikTracker.enableLinkTracking();
    } catch( err ) {}
  </script><noscript><p><img src="http://joedicastro.com/piwik/piwik.php?idsite=1" style="border:0" alt="" /></p></noscript>


<script type="text/javascript">
    var disqus_shortname = 'joedicastro';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>

</body>
</html>